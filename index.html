<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radio France Streamers</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.3.2/dist/hls.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
  <style>
    /* Hide the video element completely */
    #my-video {
      display: none;
    }
    body {
      font-family: sans-serif;
      margin: 5px; /* Reduced margin */
      padding: 0;
      background-color: #f0f0f0;
      color: #333;
    }
    #metadataMessage {
      font-size: 0.8em; /* Further reduced font size */
      margin-bottom: 5px; /* Reduced margin */
      color: #555;
    }
    #station-list {
      list-style: none;
      padding: 0;
      margin: 0 0 10px 0; /* Reduced margin */
    }
    #station-list li {
      margin-bottom: 3px; /* Reduced gap between items */
    }
    #station-list a {
      display: block;
      padding: 6px 8px; /* Reduced padding for smaller buttons */
      background-color: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-size: 0.8em; /* Further reduced font size */
      text-align: center;
    }
    #station-list a:hover {
      background-color: #0056b3;
    }
    button {
      width: 100%;
      padding: 8px 0; /* Reduced padding for smaller button */
      font-size: 0.9em; /* Further reduced font size */
      margin-bottom: 8px; /* Reduced margin */
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>

<body>

  <p id="metadataMessage">Radio France player v1.4: </p>

  <ul id="station-list">
    <li><a id="france-inter" href="https://stream.radiofrance.fr/franceinter/franceinter.m3u8?id=radiofranceBose">France Inter</a></li>
    <li><a id="franceinfo" href="https://stream.radiofrance.fr/franceinfo/franceinfo.m3u8?id=radiofranceBose">Franceinfo</a></li>
    <li><a id="france-culture" href="https://stream.radiofrance.fr/franceculture/franceculture.m3u8?id=radiofranceBose">France Culture</a></li>
    <li><a id="france-musique" href="https://stream.radiofrance.fr/francemusique/francemusique.m3u8?id=radiofranceBose">France Musique</a></li>
    <li><a id="fipRock" href="https://stream.radiofrance.fr/fiprock/fiprock.m3u8?id=radiofranceBose">FIP Rock</a></li>
    <li><a id="mouv" href="https://stream.radiofrance.fr/mouv/mouv.m3u8?id=radiofranceBose">Mouv'</a></li>
  </ul>

  <button id="playPauseButton">Play</button>

  <video id="my-video" controls playsinline></video>

  <script>
    const hls = new Hls();
    const video = document.getElementById('my-video');
    hls.attachMedia(video);

    const anchors = document.querySelectorAll('a');
    let currentIndex = -1; // Keeps track of the current station index

    const playPauseButton = document.getElementById('playPauseButton');

    // Function to update Media Session metadata
    function updateMediaSessionMetadata(title, artist, album, artwork) {
      if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
          title: title,
          artist: artist,
          album: album,
          artwork: [
            { src: artwork, sizes: '512x512', type: 'image/png' }
          ]
        });

        // Set action handlers
        navigator.mediaSession.setActionHandler('play', () => video.play());
        navigator.mediaSession.setActionHandler('pause', () => video.pause());
        navigator.mediaSession.setActionHandler('nexttrack', playNextStation);
        navigator.mediaSession.setActionHandler('previoustrack', playPreviousStation);
      }
    }

    // Function to play a station by index
    function playStation(index) {
      if (index >= 0 && index < anchors.length) {
        const anchor = anchors[index];
        const url = anchor.href;
        const radiotitle = anchor.id;

        hls.loadSource(url);
        setTimeout(() => {
          video.play();
        }, 500);

        // Update metadata message
        document.getElementById('metadataMessage').textContent = `Now playing: ${radiotitle}`;

        // Update Media Session metadata
        updateMediaSessionMetadata(radiotitle, "Radio France", "Live Stream", "https://www.logotheque-vectorielle.fr/wp-content/uploads/2023/11/logo-vectoriel-radio-france.jpg");

        // Update current index
        currentIndex = index;

        // Update Play/Pause button text
        playPauseButton.textContent = "Pause";
      }
    }

    // Function to play the next station
    function playNextStation() {
      const nextIndex = (currentIndex + 1) % anchors.length; // Wrap around to the first station
      playStation(nextIndex);
    }

    // Function to play the previous station
    function playPreviousStation() {
      const previousIndex = (currentIndex - 1 + anchors.length) % anchors.length; // Wrap around to the last station
      playStation(previousIndex);
    }

    // Event listener for station links
    anchors.forEach((anchor, index) => {
      anchor.addEventListener('click', (event) => {
        event.preventDefault();
        playStation(index);
      });
    });

    // Event listener for Play/Pause button
    playPauseButton.addEventListener('click', () => {
      if (video.paused) {
        video.play();
        playPauseButton.textContent = "Pause";
      } else {
        video.pause();
        playPauseButton.textContent = "Play";
      }
    });

    // Update Play/Pause button state when playback is paused or resumed
    video.addEventListener('play', () => {
      playPauseButton.textContent = "Pause";
    });

    video.addEventListener('pause', () => {
      playPauseButton.textContent = "Play";
    });

    // Key event listener for keyboard (for desktop testing or devices with physical keyboards)
    document.addEventListener('keydown', (event) => {
      if (event.key === '0') {
        video.paused ? video.play() : video.pause();
      }
      if (event.key === 'ArrowRight') {
        playNextStation();
      }
      if (event.key === 'ArrowLeft') {
        playPreviousStation();
      }
    });
  </script>
</body>
</html>
