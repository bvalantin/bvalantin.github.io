<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radio France Streamers</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.3.2/dist/hls.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
  <style>
    /* Existing styles... */
  </style>
</head>
<body>

  <!-- Message to display metadata -->
  <p id="metadataMessage">Now playing: </p>

  <!-- Station list-->
  <ul id="station-list">
    <li><a id="france-inter" href="https://stream.radiofrance.fr/franceinter/franceinter.m3u8?id=radiofranceBose">France Inter</a></li>
    <li><a id="franceinfo" href="https://stream.radiofrance.fr/franceinfo/franceinfo.m3u8?id=radiofranceBose">Franceinfo</a></li>
    <li><a id="france-culture" href="https://stream.radiofrance.fr/franceculture/franceculture.m3u8?id=radiofranceBose">France Culture</a></li>
    <li><a id="france-musique" href="https://stream.radiofrance.fr/francemusique/francemusique.m3u8?id=radiofranceBose">France Musique</a></li>
    <li><a id="fipRock" href="https://stream.radiofrance.fr/fiprock/fiprock.m3u8?id=radiofranceBose">FIP Rock</a></li>
    <li><a id="mouv" href="https://stream.radiofrance.fr/mouv/mouv.m3u8?id=radiofranceBose">Mouv'</a></li>
  </ul>

  <video id="my-video" controls playsinline></video>

  <script>
    const hls = new Hls();
    const video = document.getElementById('my-video');
    hls.attachMedia(video);
    const stationList = document.getElementById('station-list');
    const anchors = stationList.querySelectorAll('a');
    let currentStationIndex = -1;

    anchors.forEach((anchor, index) => {
      anchor.addEventListener('click', (event) => {
        event.preventDefault();
        playStation(index);
        const title = = event.target.id; // Use the ID as the title
      });
    });

    // Function to stream radio station using hls library
    function playStation(index) {
      if (index >= 0 && index < anchors.length) {
        const url = anchors[index].href;
        hls.loadSource(url);
        setTimeout(() => {
          video.play();
        }, 500);
        currentStationIndex = index;
      }
      // Display metadata to the user
      const metadataMessage = document.getElementById('metadataMessage');
      metadataMessage.textContent = `Now playing: ${title}`;
    }

    // Function to update metadata
    function updateBluetoothMetadata() {
      if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
          title: title, // Set the title from the ID        title: "Song Title",
          artist: title,
          album: title,
        });
      }

    }

    // Event listener for loaded metadata
    video.addEventListener('loadedmetadata', () => {
      console.log("Metadata loaded");
      updateBluetoothMetadata();
    });

    // Handle play/pause actions from Bluetooth device
if ('mediaSession' in navigator) {
  navigator.mediaSession.setActionHandler('play', () => {
    video.play();
  });

  navigator.mediaSession.setActionHandler('pause', () => {
    video.pause();
  });
}




    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      console.log('Manifest parsed!');
    });

    window.addEventListener('offline', function() {
      if (!video.paused) {
        video.pause();
        hls.stopLoad();
      }
    });
  </script>
</body>
</html>
